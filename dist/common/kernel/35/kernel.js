"use strict";define(["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels","./lang"],function(e,t,n,o,r){let i,s={appendCss:function(e,t){let n=document.createElement("link");return self.less&&!t?(n.rel="stylesheet/less",n.href=e+".less",less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=e+".css"),document.head.appendChild(n)},removeCss:function(e){e.remove(),"stylesheet/less"===e.rel&&(less.sheets.splice(less.sheets.indexOf(e),1),less.refresh())},buildHash:function(e){let t="#!"+encodeURIComponent(e.id);for(let n in e.args)t+=void 0===e.args[n]?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(e.args[n]);return t},parseHash:function(e){let n={id:i,args:{}},o=(e=e.substr(1).replace(/[#?].*$/,"")).match(/[^=&]+(=[^&]*)?/g);if(o&&"!"===o[0].charAt(0)){let e=decodeURIComponent(o[0].substr(1));t.hasOwnProperty(e)&&(n.id=e);for(let t=1;t<o.length;t++)(e=o[t].match(/^([^=]+)(=)?(.+)?$/))&&(n.args[decodeURIComponent(e[1])]=e[2]?decodeURIComponent(e[3]||""):void 0)}return n},isSameLocation:function(e,t){if(e.id===t.id&&Object.keys(e.args).length===Object.keys(t.args).length){for(let n in e.args){if(!t.args.hasOwnProperty(n))return!1;if(void 0===e.args[n]){if(e.args[n]!==t.args[n])return!1}else if(""+e.args[n]!=""+t.args[n])return!1}return!0}return!1},replaceLocation:function(e){s.location&&s.isSameLocation(e,s.location)?s.reloadPage():location.replace(s.buildHash(e))},getLang:function(e){if(navigator.languages){for(let t=0;t<navigator.languages.length;t++)if(e.hasOwnProperty(navigator.languages[t]))return e[navigator.languages[t]]}else if(e.hasOwnProperty(navigator.language))return e[navigator.language];return e.en}};return r=s.getLang(r),function(){let e="function"==typeof Symbol?Symbol("xEvents"):"xEvents";function t(t){this[e][t.type].locked=!0;for(let n=0;n<this[e][t.type].heap.length;n++)this[e][t.type].heap[n].call(this,t);for(this[e][t.type].locked=!1;this[e][t.type].stack.length;){if(this[e][t.type].stack[0])if("function"==typeof this[e][t.type].stack[0]){let n=this[e][t.type].heap.indexOf(this[e][t.type].stack[0]);n>=0&&this[e][t.type].heap.splice(n,1)}else this[e][t.type].heap.indexOf(this[e][t.type].stack[0][0])<0&&this[e][t.type].heap.push(this[e][t.type].stack[0][0]);else this[e][t.type].heap.splice(0);this[e][t.type].stack.shift()}n(this,t.type)}function n(t,n,o){!o&&t[e][n].heap.length||(delete t[e][n],t["on"+n]=null)}s.listeners={add:function(n,o,r){let i=0;return"function"==typeof r&&(n.hasOwnProperty(e)||(n[e]={}),n[e].hasOwnProperty(o)||(n[e][o]={stack:[],heap:[],locked:!1},n["on"+o]=t),n[e][o].locked?(n[e][o].stack.push([r]),i=2):n[e][o].heap.indexOf(r)<0&&(n[e][o].heap.push(r),i=1)),i},list:function(t,n){let o;if(n)o=t.hasOwnProperty(e)&&t[e].hasOwnProperty(n)?t[e][n].heap.slice(0):[];else if(o={},t.hasOwnProperty(e))for(let r in t[e])o[r]=t[e][r].heap.slice(0);return o},remove:function(t,o,r){let i=0;if(t.hasOwnProperty(e))if(o){if(t[e].hasOwnProperty(o))if(t[e][o].locked)t[e][o].stack.push(r),i=2;else if("function"==typeof r){let s=t[e][o].heap.indexOf(r);s>=0&&(t[e][o].heap.splice(s,1),n(t,o),i=1)}else n(t,o,!0),i=1}else{for(let o in t[e])t[e][o].locked?(t[e][o].stack.push(void 0),i=2):n(t,o,!0);i||(i=1)}return i}}}(),function(){let e,t,n,r=document.querySelector("#panel"),i=r.querySelector(":scope>.contents>div");function c(e,o){let r,s;t=!0,o?(r=0,s="-100%",i.style.marginLeft=s):(r="-100%",s=0,i.style.marginLeft=""),i.animate([{marginLeft:r},{marginLeft:s}],{duration:200,easing:"ease-in-out"}).onfinish=function(){if(this.onfinish=null,t=!1,e(),"function"==typeof n){let e=n;n=void 0,e()}}}function u(){if("function"!=typeof o[e].onunload||!o[e].onunload())return o[e].status--,c(function(){"function"==typeof o[e].onunloadend&&o[e].onunloadend(),o[e].status--,i.querySelector(":scope>div."+e).style.display=r.style.display="",o[e].autoDestroy&&a(o[e],"panel",e),e=void 0},!1),!0}s.openPanel=function(e,t){if(o.hasOwnProperty(e))return l("panel",o[e],e,function(){"function"==typeof o[e].open?o[e].open(t):s.showPanel(e)}),!0},s.showPanel=function(a){let l=0;return o[a].status>1&&(t?(n=s.showPanel.bind(this,a),l=2):e?e===a?("function"==typeof o[a].onload&&o[a].onload(),"function"==typeof o[a].onloadend&&o[a].onloadend(),l=1):u()&&(n=s.showPanel.bind(this,a),l=1):(o[a].status++,"function"==typeof o[a].onload&&o[a].onload(),r.className=e=a,r.style.display=i.querySelector(":scope>div."+a).style.display="block",c(function(){"function"==typeof o[a].onloadend&&o[a].onloadend(),o[a].status++},!0),l=1)),l},s.closePanel=function(o){let r=0;return t?(n=s.closePanel.bind(this,o),r=2):e&&(!o||e===o||Array.isArray(o)&&o.indexOf(e)>=0)&&u()&&(r=1),r},s.getCurrentPanel=function(){return e},s.destroyPanel=function(e){if(2===o[e].status)return a(o[e],"panel",e),!0},n=s.closePanel.bind(s,void 0),i.querySelector(":scope>a.close").addEventListener("click",n),r.querySelector(":scope>.mask").addEventListener("click",n),n=void 0}(),function(){let e,t=document.getElementById("popup"),o=t.querySelector(":scope>div");s.openPopup=function(e,t){if(n.hasOwnProperty(e))return l("popup",n[e],e,function(){"function"==typeof n[e].open?n[e].open(t):s.showPopup(e)}),!0},s.showPopup=function(r){let i;return n[r].status>1&&(e?e===r?("function"==typeof n[r].onload&&n[r].onload(),i=!0):"function"==typeof n[e].onunload&&n[e].onunload()||(n[e].status--,o.querySelector(":scope>div."+e).style.display="",n[e].autoDestroy&&a(n[e],"popup",e),o.querySelector(":scope>div."+r).style.display="block",t.className=e=r,n[r].status++,"function"==typeof n[r].onload&&n[r].onload(),i=!0):(o.querySelector(":scope>div."+r).style.display=t.style.display="block",t.className=e=r,"function"==typeof s.popupEvents.onshow&&s.popupEvents.onshow({type:"show",id:e}),n[r].status++,"function"==typeof n[r].onload&&n[r].onload(),i=!0)),i},s.closePopup=function(r){let i;if(e&&(!r||e===r||Array.isArray(r)&&r.indexOf(e)>=0)&&("function"!=typeof n[e].onunload||!n[e].onunload()))return n[e].status--,i=e,o.querySelector(":scope>div."+e).style.display=t.style.display=t.className=e="",n[i].autoDestroy&&a(n[i],"popup",e),"function"==typeof s.popupEvents.onhide&&s.popupEvents.onhide({type:"hide",id:i}),!0},s.getCurrentPopup=function(){return e},s.destroyPopup=function(e){if(2===n[e].status)return a(n[e],"popup",e),!0},s.popupEvents={},t.querySelector(":scope>div>a").addEventListener("click",s.closePopup.bind(s,void 0))}(),function(){let t,n,o=document.querySelector("#photoview"),r=o.querySelector("a.close"),i=o.querySelector("a.prev"),a=o.querySelector("a.next"),c=o.querySelector("a.rotate.p"),l=o.querySelector("a.rotate.n"),u=e(o.querySelector(":scope>div")),p=[],d=[];function f(){t=self.innerWidth,n=self.innerHeight,"number"==typeof u.current&&p[u.current]&&y(u.current)}function h(e){u.children[e].addEventListener("load",function t(){this.removeEventListener("load",t);p[e]={w:this.width,h:this.height};d[e]=0;u.current===e&&y(e);this.style.visibility="visible"})}function y(e){let o,r,i,s,a,c=d[e]%2;c?(s=p[e].h,a=p[e].w):(s=p[e].w,a=p[e].h),s>t||a>n?(t/n>(o=s/a)?r=(i=n)*o:i=(r=t)/o,c?(s=i,a=r):(s=r,a=i),u.children[e].style.cursor="zoom-in"):(s=p[e].w,a=p[e].h,u.children[e].style.cursor=""),u.children[e].style.top=(n-a)/2+"px",u.children[e].style.left=(t-s)/2+"px",u.children[e].style.width=s+"px",u.children[e].style.height=a+"px",u.children[e].style.transform="rotate("+90*d[e]+"deg)"}s.showPhotoView=function(e,t){if(Array.isArray(e)){for(let t=0;t<e.length;t++){let n=document.createElement("img");n.src=e[t],u.add(n),h(t)}t>=0&&t<u.children.length&&u.slideTo(t,!0),u.children.length>1?i.style.display=a.style.display="block":i.style.display=a.style.display=""}},s.hidePhotoView=function(){for(p=[];u.children.length;)u.remove(0)},o.addEventListener("click",function(e){if("IMG"===e.target.nodeName)if("zoom-in"===e.target.style.cursor){d[u.current]%2?(e.target.style.top=p[u.current].w>n?(p[u.current].w-p[u.current].h)/2+"px":(n-p[u.current].h)/2+"px",e.target.style.left=p[u.current].h>t?(p[u.current].h-p[u.current].w)/2+"px":(t-p[u.current].w)/2+"px"):(e.target.style.top=p[u.current].h>n?0:(n-p[u.current].h)/2+"px",e.target.style.left=p[u.current].w>t?0:(t-p[u.current].w)/2+"px"),e.target.style.width=p[u.current].w+"px",e.target.style.height=p[u.current].h+"px",e.target.style.cursor="zoom-out"}else"zoom-out"===e.target.style.cursor&&y(u.current)}),self.addEventListener("resize",f),i.addEventListener("click",function(){u.slideTo(u.current-1)}),a.addEventListener("click",function(){u.slideTo(u.current+1)}),c.addEventListener("click",function(){"number"==typeof d[u.current]&&(d[u.current]++,y(u.current))}),l.addEventListener("click",function(){"number"==typeof d[u.current]&&(d[u.current]--,y(u.current))}),r.addEventListener("click",s.hidePhotoView),u.onchange=function(){void 0===this.current?o.style.display="":(p[this.current]&&y(this.current),o.style.display="block")},"transform"in document.documentElement.style&&(c.style.display="block",l.style.display="block"),f()}(),function(){let e,t,n,o=0,i=document.querySelector("#hint"),a=document.querySelector("#readable"),c=document.querySelector("#dialog"),l=document.querySelector("#loading"),u=[];s.showLoading=function(e){l.querySelector(":scope>div>div").textContent=e||r.loading,0===o&&(l.style.display="block"),o+=1},s.hideLoading=function(){o>0&&0===(o-=1)&&(l.style.display="","function"==typeof s.dialogEvents.onloaded&&s.dialogEvents.onloaded({type:"loaded"}))},s.isLoading=function(){return o>0},s.hint=function(t,n,o){i.className=n||"",i.querySelector("span").textContent=t,e?clearTimeout(e):(i.style.opacity=1,i.animate([{opacity:0},{opacity:1}],{duration:400,easing:"ease-in-out"})),o||(o="error"===n?4e3:"warning"===n?3e3:2e3),e=setTimeout(function(){e=0,i.style.opacity="",i.animate([{opacity:1},{opacity:0}],{duration:400,easing:"ease-in-out"})},o)},s.showReadable=function(e,t,o,r,i){let s=a.querySelector(":scope>div");a.className=i||"",a.style.display="block",s.style.width=t,s.style.height=o,s=s.querySelector(":scope>div"),"string"==typeof e?s.innerHTML=e:s.appendChild(e),n=r},s.hideReadable=function(){"function"==typeof n&&(n(),n=void 0),a.style.display="",a.querySelector(":scope>div>div").innerHTML=""},s.hideDialog=function(e){let n;"function"==typeof t&&(n=t,t=void 0,n("isConfirm"===c.className?e:void 0)),c.className="",u.length&&(n=u.shift(),s[n.shift()].apply(s,n))},s.showForeign=function(e,t,n,o){s.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+e+'"></iframe>',t,n,o,"foreign")},s.confirm=function(e,n,o){let i,s,a,l;c.className?u.push(["confirm",e,n,o]):(s=(i=c.querySelector(":scope>div")).querySelector(":scope>div>div"),a=i.querySelector(":scope>a.yes"),l=i.querySelector(":scope>a.no"),t=n,i.style.width=o||"400px",Array.isArray(e)?(s.textContent=e[0],a.textContent=e[1],l.textContent=e[2]):(s.textContent=e,a.textContent=r.yes,l.textContent=r.no),c.className="isConfirm",i.style.height=s.offsetHeight+Math.max(a.offsetHeight,l.offsetHeight)+76+"px")},s.alert=function(e,n,o){let r,i;c.className?u.push(["alert",e,n,o]):(i=(r=c.querySelector(":scope>div")).querySelector(":scope>div>div"),t=n,r.style.width=o||"400px",i.textContent=e,c.className="isAlert",r.style.height=i.offsetHeight+46+"px")},a.querySelector(":scope>div>a").addEventListener("click",s.hideReadable),c.querySelector(":scope>div>a.close").addEventListener("click",s.hideDialog),c.querySelector(":scope>div>a.yes").addEventListener("click",s.hideDialog.bind(s,!0)),c.querySelector(":scope>div>a.no").addEventListener("click",s.hideDialog.bind(s,!1)),s.dialogEvents={}}(),function(){let e;function n(n,o){(!n||n===e||Array.isArray(n)&&n.indexOf(e)>=0)&&(o||u(),"function"==typeof t[e].onload&&t[e].onload(!0))}function o(){let n=history.state,o=s.parseHash(location.hash);history.replaceState&&history.replaceState(!0,null),s.location&&s.isSameLocation(s.location,o)||(s.lastLocation=s.location,s.location=o,s.lastLocation&&u(),"function"==typeof s.pageEvents.onroute&&s.pageEvents.onroute({type:"route",history:n}),l("page",t[o.id],o.id,function(r){let i;o.id!==e?(i=r||!n,e&&("function"==typeof t[e].onunload&&t[e].onunload(),t[e].status--,c("page",e).style.display="",t[e].autoDestroy&&a(t[e],"popup",activePopup)),document.body.className=e=o.id,c("page",o.id).style.display="block",t[o.id].status++,"function"==typeof t[o.id].onload&&t[o.id].onload(i)):"function"==typeof t[o.id].onload&&t[o.id].onload(),"function"==typeof s.pageEvents.onrouteend&&s.pageEvents.onrouteend({type:"routeend",history:n,force:i})}))}s.init=function(e){let n,r,a;if(t.hasOwnProperty(e))if(i){if(i!==e&&(r=i,i=e,s.location.id===r))return o(),!0}else i=e,"onhashchange"in self?self.addEventListener("hashchange",o):(setInterval(function(){n!==location.hash&&(n=location.hash,o())},10),n=location.hash),o(),s.location.args.hasOwnProperty("autopopup")&&(s.location.args.hasOwnProperty("autopopuparg")&&(a=s.location.args.autopopuparg.parseJsex())&&(a=a.value),s.openPopup(s.location.args.autopopup,a))},s.reloadPage=function(e,t){let o;s.isLoading()?(o=s.location,s.listeners.add(s.dialogEvents,"loaded",function r(i){s.listeners.remove(this,i.type,r);o===s.location&&n(e,t)})):n(e,t)},s.destroyPage=function(e){if(2===t[e].status)return a(t[e],"page",e),!0},s.pageEvents={}}(),s;function a(e,t,n){let o,r=c(t,n);r&&("function"==typeof e.ondestroy&&e.ondestroy(),r.remove(),e.js&&(o=t+"/"+n+"/"+n,require.defined(o)&&(r=require(o),require.undef(o),r&&(self.Reflect?Reflect.setPrototypeOf(e,Object.prototype):e.__proto__=Object.prototype)))),e.css&&e.css.href&&(s.removeCss(e.css),e.css=!0),delete e.status}function c(e,t){let n="#"+e;return"popup"===e?n+=">div":"panel"===e&&(n+=">.contents>div"),t&&(n+=">div."+t),document.querySelector(n)}function l(e,t,n,o){let i,l,u,p;function d(r){let i,u=c(e);u.insertAdjacentHTML("afterBegin",'<div class="'+n+'">'+r+"</div>"),t.js?(u.firstChild.style.visibility="hidden",s.showLoading(),s.listeners.add(s.dialogEvents,"loaded",function e(t){s.listeners.remove(this,t.type,e);u.querySelector(":scope>div."+n).style.visibility=""}),i=l+n,require([i],function(e){e&&(self.Reflect?Reflect.setPrototypeOf(t,e):t.__proto__=e),t.status++,o(!0),s.hideLoading()},BUILD&&function(o){a(t,e,n),o.requireType&&"scripterror"!==o.requireType&&"nodefine"!==o.requireType||o.xhr&&404!==o.xhr.status?f(i,o.message):h(),s.hideLoading()})):(t.status++,o(!0))}function f(e,t){s.alert(r.error.replace("${res}",e)+t,p?function(){history.back()}:void 0)}function h(){p?location.reload():s.confirm(r.update,function(e){e&&location.reload()})}t.status>1?o():t.status||(t.status=1,l=e+"/"+n+"/",u=require.toUrl(l),p="page"===e,t.css&&(t.css=s.appendCss(u+n)),t.html?(i=u+n+".html",fetch(i).then(o=>{if(o.ok)return o.text().then(e=>d(e));a(t,e,n),BUILD&&404===o.status?h():f(i,o.status)}).then(s.hideLoading),s.showLoading()):d(""))}function u(){s.closePanel(),s.closePopup(),s.hideReadable()}});