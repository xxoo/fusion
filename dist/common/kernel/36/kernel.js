"use strict";define(["common/slider/slider","site/pages/pages","site/popups/popups","site/panels/panels","./lang"],function(t,e,n,o,i){let s,r={appendCss:function(t,e){let n=document.createElement("link");return self.less&&!e?(n.rel="stylesheet/less",n.href=t+".less",less.sheets.push(n),less.refresh()):(n.rel="stylesheet",n.href=t+".css"),document.head.appendChild(n)},removeCss:function(t){t.remove(),"stylesheet/less"===t.rel&&(less.sheets.splice(less.sheets.indexOf(t),1),less.refresh())},buildHash:function(t){let e="#!"+encodeURIComponent(t.id);for(let n in t.args)e+=void 0===t.args[n]?"&"+encodeURIComponent(n):"&"+encodeURIComponent(n)+"="+encodeURIComponent(t.args[n]);return e},parseHash:function(t){let n={id:s,args:{}},o=(t=t.substr(1).replace(/[#?].*$/,"")).match(/[^=&]+(=[^&]*)?/g);if(o&&"!"===o[0].charAt(0)){let t=decodeURIComponent(o[0].substr(1));e.hasOwnProperty(t)&&(n.id=t);for(let e=1;e<o.length;e++)(t=o[e].match(/^([^=]+)(=)?(.+)?$/))&&(n.args[decodeURIComponent(t[1])]=t[2]?decodeURIComponent(t[3]||""):void 0)}return n},isSameLocation:function(t,e){if(t.id===e.id&&Object.keys(t.args).length===Object.keys(e.args).length){for(let n in t.args){if(!e.args.hasOwnProperty(n))return!1;if(void 0===t.args[n]){if(t.args[n]!==e.args[n])return!1}else if(""+t.args[n]!=""+e.args[n])return!1}return!0}return!1},replaceLocation:function(t){r.location&&r.isSameLocation(t,r.location)?r.reloadPage():location.replace(r.buildHash(t))},getLang:function(t){if(navigator.languages){for(let e=0;e<navigator.languages.length;e++)if(t.hasOwnProperty(navigator.languages[e]))return t[navigator.languages[e]]}else if(t.hasOwnProperty(navigator.language))return t[navigator.language];return t.en}};return i=r.getLang(i),function(){let t="function"==typeof Symbol?Symbol("xEvents"):"xEvents";function e(e){this[t][e.type].locked=!0;for(let n=0;n<this[t][e.type].heap.length;n++)this[t][e.type].heap[n].call(this,e);for(this[t][e.type].locked=!1;this[t][e.type].stack.length;){if(this[t][e.type].stack[0])if("function"==typeof this[t][e.type].stack[0]){let n=this[t][e.type].heap.indexOf(this[t][e.type].stack[0]);n>=0&&this[t][e.type].heap.splice(n,1)}else this[t][e.type].heap.indexOf(this[t][e.type].stack[0][0])<0&&this[t][e.type].heap.push(this[t][e.type].stack[0][0]);else this[t][e.type].heap.splice(0);this[t][e.type].stack.shift()}n(this,e.type)}function n(e,n,o){!o&&e[t][n].heap.length||(delete e[t][n],e["on"+n]=null)}r.listeners={add:function(n,o,i){let s=0;return"function"==typeof i&&(n.hasOwnProperty(t)||(n[t]={}),n[t].hasOwnProperty(o)||(n[t][o]={stack:[],heap:[],locked:!1},n["on"+o]=e),n[t][o].locked?(n[t][o].stack.push([i]),s=2):n[t][o].heap.indexOf(i)<0&&(n[t][o].heap.push(i),s=1)),s},list:function(e,n){let o;if(n)o=e.hasOwnProperty(t)&&e[t].hasOwnProperty(n)?e[t][n].heap.slice(0):[];else if(o={},e.hasOwnProperty(t))for(let i in e[t])o[i]=e[t][i].heap.slice(0);return o},remove:function(e,o,i){let s=0;if(e.hasOwnProperty(t))if(o){if(e[t].hasOwnProperty(o))if(e[t][o].locked)e[t][o].stack.push(i),s=2;else if("function"==typeof i){let r=e[t][o].heap.indexOf(i);r>=0&&(e[t][o].heap.splice(r,1),n(e,o),s=1)}else n(e,o,!0),s=1}else{for(let o in e[t])e[t][o].locked?(e[t][o].stack.push(void 0),s=2):n(e,o,!0);s||(s=1)}return s}}}(),function(){let t,e,n,i=document.querySelector("#panel"),s=i.querySelector(":scope>.contents>div");function c(t,o){let i,r;e=!0,o?(i=0,r="-100%",s.style.marginLeft=r):(i="-100%",r=0,s.style.marginLeft=""),s.animate([{marginLeft:i},{marginLeft:r}],{duration:200,easing:"ease-in-out"}).onfinish=function(){if(this.onfinish=null,e=!1,t(),"function"==typeof n){let t=n;n=void 0,t()}}}function u(){if("function"!=typeof o[t].onunload||!o[t].onunload())return o[t].status--,c(function(){"function"==typeof o[t].onunloadend&&o[t].onunloadend(),o[t].status--,s.querySelector(":scope>div."+t).style.display=i.style.display="",o[t].autoDestroy&&a(o[t],"panel",t),t=void 0},!1),!0}r.openPanel=function(t,e){if(o.hasOwnProperty(t))return l("panel",o[t],t,function(){"function"==typeof o[t].open?o[t].open(e):r.showPanel(t)}),!0},r.showPanel=function(a){let l=0;return o[a].status>1&&(e?(n=r.showPanel.bind(this,a),l=2):t?t===a?("function"==typeof o[a].onload&&o[a].onload(),"function"==typeof o[a].onloadend&&o[a].onloadend(),l=1):u()&&(n=r.showPanel.bind(this,a),l=1):(o[a].status++,"function"==typeof o[a].onload&&o[a].onload(),i.className=t=a,i.style.display=s.querySelector(":scope>div."+a).style.display="block",c(function(){"function"==typeof o[a].onloadend&&o[a].onloadend(),o[a].status++},!0),l=1)),l},r.closePanel=function(o){let i=0;return e?(n=r.closePanel.bind(this,o),i=2):t&&(!o||t===o||Array.isArray(o)&&o.indexOf(t)>=0)&&u()&&(i=1),i},r.getCurrentPanel=function(){return t},r.destroyPanel=function(t){if(2===o[t].status)return a(o[t],"panel",t),!0},n=r.closePanel.bind(r,void 0),s.querySelector(":scope>a.close").addEventListener("click",n),i.querySelector(":scope>.mask").addEventListener("click",n),n=void 0}(),function(){let t,e=document.getElementById("popup"),o=e.querySelector(":scope>div");r.openPopup=function(t,e){if(n.hasOwnProperty(t))return l("popup",n[t],t,function(){"function"==typeof n[t].open?n[t].open(e):r.showPopup(t)}),!0},r.showPopup=function(i){let s;return n[i].status>1&&(t?t===i?("function"==typeof n[i].onload&&n[i].onload(),s=!0):"function"==typeof n[t].onunload&&n[t].onunload()||(n[t].status--,o.querySelector(":scope>div."+t).style.display="",n[t].autoDestroy&&a(n[t],"popup",t),o.querySelector(":scope>div."+i).style.display="block",e.className=t=i,n[i].status++,"function"==typeof n[i].onload&&n[i].onload(),s=!0):(o.querySelector(":scope>div."+i).style.display=e.style.display="block",e.className=t=i,"function"==typeof r.popupEvents.onshow&&r.popupEvents.onshow({type:"show",id:t}),n[i].status++,"function"==typeof n[i].onload&&n[i].onload(),s=!0)),s},r.closePopup=function(i){let s;if(t&&(!i||t===i||Array.isArray(i)&&i.indexOf(t)>=0)&&("function"!=typeof n[t].onunload||!n[t].onunload()))return n[t].status--,s=t,o.querySelector(":scope>div."+t).style.display=e.style.display=e.className=t="",n[s].autoDestroy&&a(n[s],"popup",t),"function"==typeof r.popupEvents.onhide&&r.popupEvents.onhide({type:"hide",id:s}),!0},r.getCurrentPopup=function(){return t},r.destroyPopup=function(t){if(2===n[t].status)return a(n[t],"popup",t),!0},r.popupEvents={},e.querySelector(":scope>div>a").addEventListener("click",r.closePopup.bind(r,void 0))}(),function(){let e,n,o=document.querySelector("#photoview"),i=o.querySelector("a.close"),s=o.querySelector("a.prev"),a=o.querySelector("a.next"),c=o.querySelector("a.rotate.p"),l=o.querySelector("a.rotate.n"),u=t(o.querySelector(":scope>div")),p=[],d=[];function f(){e=self.innerWidth,n=self.innerHeight,"number"==typeof u.current&&p[u.current]&&y(u.current)}function h(t){u.children[t].addEventListener("load",function e(){this.removeEventListener("load",e);p[t]={w:this.width,h:this.height};d[t]=0;u.current===t&&y(t);this.style.visibility="visible"})}function y(t){let o,i,s,r,a,c=d[t]%2;c?(r=p[t].h,a=p[t].w):(r=p[t].w,a=p[t].h),r>e||a>n?(e/n>(o=r/a)?i=(s=n)*o:s=(i=e)/o,c?(r=s,a=i):(r=i,a=s),u.children[t].style.cursor="zoom-in"):(r=p[t].w,a=p[t].h,u.children[t].style.cursor=""),u.children[t].style.top=(n-a)/2+"px",u.children[t].style.left=(e-r)/2+"px",u.children[t].style.width=r+"px",u.children[t].style.height=a+"px",u.children[t].style.transform="rotate("+90*d[t]+"deg)"}r.showPhotoView=function(t,e){if(Array.isArray(t)){for(let e=0;e<t.length;e++){let n=document.createElement("img");n.src=t[e],u.add(n),h(e)}e>=0&&e<u.children.length&&u.slideTo(e,!0),u.children.length>1?s.style.display=a.style.display="block":s.style.display=a.style.display=""}},r.hidePhotoView=function(){for(p=[];u.children.length;)u.remove(0)},o.addEventListener("click",function(t){if("IMG"===t.target.nodeName)if("zoom-in"===t.target.style.cursor){d[u.current]%2?(t.target.style.top=p[u.current].w>n?(p[u.current].w-p[u.current].h)/2+"px":(n-p[u.current].h)/2+"px",t.target.style.left=p[u.current].h>e?(p[u.current].h-p[u.current].w)/2+"px":(e-p[u.current].w)/2+"px"):(t.target.style.top=p[u.current].h>n?0:(n-p[u.current].h)/2+"px",t.target.style.left=p[u.current].w>e?0:(e-p[u.current].w)/2+"px"),t.target.style.width=p[u.current].w+"px",t.target.style.height=p[u.current].h+"px",t.target.style.cursor="zoom-out"}else"zoom-out"===t.target.style.cursor&&y(u.current)}),self.addEventListener("resize",f),s.addEventListener("click",function(){u.slideTo(u.current-1)}),a.addEventListener("click",function(){u.slideTo(u.current+1)}),c.addEventListener("click",function(){"number"==typeof d[u.current]&&(d[u.current]++,y(u.current))}),l.addEventListener("click",function(){"number"==typeof d[u.current]&&(d[u.current]--,y(u.current))}),i.addEventListener("click",r.hidePhotoView),u.onchange=function(){void 0===this.current?o.style.display="":(p[this.current]&&y(this.current),o.style.display="block")},"transform"in document.documentElement.style&&(c.style.display="block",l.style.display="block"),f()}(),function(){let t,e,n,o=0,s=document.querySelector("#hint"),a=document.querySelector("#readable"),c=document.querySelector("#dialog"),l=document.querySelector("#loading"),u=[];r.showLoading=function(t){l.querySelector(":scope>div>div").textContent=t||i.loading,0===o&&(l.style.display="block"),o+=1},r.hideLoading=function(){o>0&&0===(o-=1)&&(l.style.display="","function"==typeof r.dialogEvents.onloaded&&r.dialogEvents.onloaded({type:"loaded"}))},r.isLoading=function(){return o>0},r.hint=function(e,n,o){s.className=n||"",s.querySelector("span").textContent=e,t?clearTimeout(t):(s.style.opacity=1,s.animate([{opacity:0},{opacity:1}],{duration:400,easing:"ease-in-out"})),o||(o="error"===n?4e3:"warning"===n?3e3:2e3),t=setTimeout(function(){t=0,s.style.opacity="",s.animate([{opacity:1},{opacity:0}],{duration:400,easing:"ease-in-out"})},o)},r.showReadable=function(t,e,o,i,s){let r=a.querySelector(":scope>div");a.className=s||"",a.style.display="block",r.style.width=e,r.style.height=o,r=r.querySelector(":scope>div"),"string"==typeof t?r.innerHTML=t:r.appendChild(t),n=i},r.hideReadable=function(){"function"==typeof n&&(n(),n=void 0),a.style.display="",a.querySelector(":scope>div>div").innerHTML=""},r.hideDialog=function(t){let n;"function"==typeof e&&(n=e,e=void 0,n("isConfirm"===c.className?t:void 0)),c.className="",u.length&&(n=u.shift(),r[n.shift()].apply(r,n))},r.showForeign=function(t,e,n,o){r.showReadable('<iframe frameborder="no" allowtransparency="yes" marginwidth="0" marginheight="0" src="'+t+'"></iframe>',e,n,o,"foreign")},r.confirm=function(t,n,o){let s,r,a,l;c.className?u.push(["confirm",t,n,o]):(r=(s=c.querySelector(":scope>div")).querySelector(":scope>div>div"),a=s.querySelector(":scope>a.yes"),l=s.querySelector(":scope>a.no"),e=n,s.style.width=o||"400px",Array.isArray(t)?(r.textContent=t[0],a.textContent=t[1],l.textContent=t[2]):(r.textContent=t,a.textContent=i.yes,l.textContent=i.no),c.className="isConfirm",s.style.height=r.offsetHeight+Math.max(a.offsetHeight,l.offsetHeight)+76+"px")},r.alert=function(t,n,o){let i,s;c.className?u.push(["alert",t,n,o]):(s=(i=c.querySelector(":scope>div")).querySelector(":scope>div>div"),e=n,i.style.width=o||"400px",s.textContent=t,c.className="isAlert",i.style.height=s.offsetHeight+46+"px")},a.querySelector(":scope>div>a").addEventListener("click",r.hideReadable),c.querySelector(":scope>div>a.close").addEventListener("click",r.hideDialog),c.querySelector(":scope>div>a.yes").addEventListener("click",r.hideDialog.bind(r,!0)),c.querySelector(":scope>div>a.no").addEventListener("click",r.hideDialog.bind(r,!1)),r.dialogEvents={}}(),function(){let t;function n(n,o){(!n||n===t||Array.isArray(n)&&n.indexOf(t)>=0)&&(o||u(),"function"==typeof e[t].onload&&e[t].onload(!0))}function o(){let n=history.state,o=r.parseHash(location.hash);history.replaceState&&history.replaceState(!0,null),r.location&&r.isSameLocation(r.location,o)||(r.lastLocation=r.location,r.location=o,r.lastLocation&&u(),"function"==typeof r.pageEvents.onroute&&r.pageEvents.onroute({type:"route",history:n}),l("page",e[o.id],o.id,function(i){let s;o.id!==t?(s=i||!n,t&&("function"==typeof e[t].onunload&&e[t].onunload(),e[t].status--,c("page",t).style.display="",e[t].autoDestroy&&a(e[t],"popup",activePopup)),document.body.className=t=o.id,c("page",o.id).style.display="block",e[o.id].status++,"function"==typeof e[o.id].onload&&e[o.id].onload(s)):"function"==typeof e[o.id].onload&&e[o.id].onload(),"function"==typeof r.pageEvents.onrouteend&&r.pageEvents.onrouteend({type:"routeend",history:n,force:s})}))}r.init=function(t){let n,i,a;if(e.hasOwnProperty(t))if(s){if(s!==t&&(i=s,s=t,r.location.id===i))return o(),!0}else s=t,"onhashchange"in self?self.addEventListener("hashchange",o):(setInterval(function(){n!==location.hash&&(n=location.hash,o())},10),n=location.hash),o(),r.location.args.hasOwnProperty("autopopup")&&(r.location.args.hasOwnProperty("autopopuparg")&&(a=r.location.args.autopopuparg.parseJsex())&&(a=a.value),r.openPopup(r.location.args.autopopup,a))},r.reloadPage=function(t,e){let o;r.isLoading()?(o=r.location,r.listeners.add(r.dialogEvents,"loaded",function i(s){r.listeners.remove(this,s.type,i);o===r.location&&n(t,e)})):n(t,e)},r.destroyPage=function(t){if(2===e[t].status)return a(e[t],"page",t),!0},r.pageEvents={}}(),r;function a(t,e,n){let o,i=c(e,n);i&&("function"==typeof t.ondestroy&&t.ondestroy(),i.remove(),t.js&&(o=e+"/"+n+"/"+n,require.defined(o)&&(i=require(o),require.undef(o),i&&(self.Reflect?Reflect.setPrototypeOf(t,Object.prototype):t.__proto__=Object.prototype)))),t.css&&t.css.href&&(r.removeCss(t.css),t.css=!0),delete t.status}function c(t,e){let n="#"+t;return"popup"===t?n+=">div":"panel"===t&&(n+=">.contents>div"),e&&(n+=">div."+e),document.querySelector(n)}function l(t,e,n,o){let s,l;if(e.status>1)o();else if(!e.status){e.status=1,l="page"===t,s=t+"/"+n+"/";let o=require.toUrl(s);if(e.css&&(e.css=r.appendCss(o+n)),e.html){let i=o+n+".html";fetch(i).then(o=>{if(o.ok)return o.text().then(u);a(e,t,n),BUILD&&404===o.status?d():p(i,o.status)},t=>p(i,t.message)).then(r.hideLoading),r.showLoading()}else u("")}function u(i){let l,u=c(t);u.insertAdjacentHTML("afterBegin",'<div class="'+n+'">'+i+"</div>"),e.js?(u.firstChild.style.visibility="hidden",r.showLoading(),r.listeners.add(r.dialogEvents,"loaded",function t(e){r.listeners.remove(this,e.type,t);u.querySelector(":scope>div."+n).style.visibility=""}),l=s+n,require([l],function(t){t&&(self.Reflect?Reflect.setPrototypeOf(e,t):e.__proto__=t),e.status++,o(!0),r.hideLoading()},BUILD&&function(o){a(e,t,n),o.requireType&&"scripterror"!==o.requireType&&"nodefine"!==o.requireType||o.xhr&&404!==o.xhr.status?p(l,o.message):d(),r.hideLoading()})):(e.status++,o(!0))}function p(t,e){r.alert(i.error.replace("${res}",t)+e,l?function(){history.back()}:void 0)}function d(){l?location.reload():r.confirm(i.update,function(t){t&&location.reload()})}}function u(){r.closePanel(),r.closePopup(),r.hideReadable()}});