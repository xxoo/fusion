"use strict";define(["common/fusion/fusion","./lang"],(function(t,s){const e=document.createElement("div"),i={open(s){let e,i,a;if(s.id in this.cfg){if(s.args){for(n(s.args,this.cfg[s.id].args),e=0;e<this.list.length;e++)if(t.isSameLocation(s,this.list[e])){i=!0;break}}else for(e=0;e<this.list.length;e++)if(this.list[e].id===s.id){i=!0;break}i?this.tabs[e].loaded&&(a=!0):e=this.add(s),this.show(e),a&&this.reload()}return e},add(s){let e,i;const a="tab-"+this.name+"/"+s.id+"/",o=()=>{t.listeners.off(this.cfg[s.id],"complete",o),e=this.tabs.indexOf(i),2===this.cfg[s.id].status?(d(),e>=0&&(void 0===this.active||this.active===e)&&this.show(e)):e>=0&&this.close(e)},r=()=>{let e;"js"in this.cfg[s.id]?(t.showLoading(),e=a+this.cfg[s.id].js,require([e],(e=>{delete this.cfg[s.id].js,this.cfg[s.id].proto=e,this.cfg[s.id].status=2,t.listeners.trigger(this.cfg[s.id],"complete"),t.hideLoading()}),BUILD?i=>{require.undef(e),this.cfg[s.id].status=0,this.cfg[s.id].oncomplete({type:"complete"}),i.requireType&&"scripterror"!==i.requireType&&"nodefine"!==i.requireType||i.xhr&&404!==i.xhr.status?c(e,i.message):l(),t.hideLoading()}:void 0)):(this.cfg.status=2,t.listeners.trigger(this.cfg[s.id],"complete"))},d=()=>{this.cfg[s.id].htmlContent&&(i.body.innerHTML=this.cfg[s.id].htmlContent),Object.assign(i,this.cfg[s.id].proto)};if(s.id in this.cfg){if(s.args||(s.args={}),n(s.args,this.cfg[s.id].args),i={head:document.createElement("span"),body:document.createElement("div"),args:s.args,parent:this,setTitle:h},i.head.innerHTML='<span title="'+this.cfg[s.id].title+'">'+this.cfg[s.id].title+'</span><a href="javascript:;"></a>',i.body.className=i.head.className=s.id,this.inv&&this.tabs.length?this.tabCtn.insertBefore(i.head,this.tabs[this.tabs.length-1].head):this.tabCtn.appendChild(i.head),this.tabContent.appendChild(i.body),e=this.list.length,this.list.push(s),this.tabs.push(i),"string"==typeof this.cfg[s.id].css&&(this.cfg[s.id].css=t.appendCss(require.toUrl(a+this.cfg[s.id].css))),2===this.cfg[s.id].status)d();else if(t.listeners.on(this.cfg[s.id],"complete",o),1!==this.cfg[s.id].status)if(this.cfg[s.id].status=1,"html"in this.cfg[s.id]){const e=require.toUrl(a+this.cfg[s.id].html);fetch(e).then((t=>{if(t.ok)return t.text().then((t=>{delete this.cfg[s.id].html,this.cfg[s.id].htmlContent=t,r()}));this.cfg[s.id].status=0,this.cfg[s.id].oncomplete({type:"complete"}),BUILD&&404===t.status?l():c(e,t.status)}),(t=>c(e,t.message))).then(t.hideLoading),t.showLoading()}else r();return this.save(),t.listeners.trigger(this,"change"),e}},show(t){let s;t>=0&&t<this.list.length&&("number"==typeof this.active&&this.active!==t&&("function"==typeof this.tabs[this.active].onhide&&this.tabs[this.active].onhide(),this.tabCtn.querySelector(":scope>span.active").classList.remve("active"),this.tabContent.querySelector(":scope>div.active").classList.remove("active")),this.tabs[t].body.classList.add("active"),this.tabs[t].head.classList.add("active"),2===this.cfg[this.list[t].id].status&&(this.tabs[t].loaded||(s=!0,"function"==typeof this.tabs[t].onload&&this.tabs[t].onload(),this.tabs[t].loaded=!0),this.active===t&&!s||"function"!=typeof this.tabs[t].onshow||this.tabs[t].onshow()),this.active=t,this.save())},close(s){s>=0&&s<this.tabs.length&&(this.active===s&&(this.list.length>s+1?this.show(s+1):this.list.length>1?this.show(s-1):("function"==typeof this.tabs[s].onhide&&this.tabs[s].onhide(),this.active=void 0)),this.tabs[s].loaded&&"function"==typeof this.tabs[s].onunload&&this.tabs[s].onunload(),this.tabs[s].head.remove(),this.tabs[s].body.remove(),this.tabs.splice(s,1),this.list.splice(s,1),this.active>s&&this.active--,this.save(),t.listeners.trigger(this,"change"))},clear(){if(this.tabs.length){for(let t=0;t<this.list.length;t++)t===this.active&&"function"==typeof this.tabs[t].onhide&&this.tabs[t].onhide(),this.tabs[t].loaded&&"function"==typeof this.tabs[t].onunload&&this.tabs[t].onunload(),this.tabs[t].head.remove(),this.tabs[t].body.remove();this.list=[],this.tabs=[],this.active=void 0,this.save(),t.listeners.trigger(this,"change")}},closeOther(s){if(s>0&&s<this.tabs.length-1){for(let t=0;t<this.list.length;t++)t!==s&&(t===this.active&&"function"==typeof this.tabs[t].onhide&&this.tabs[t].onhide(),this.tabs[t].loaded&&"function"==typeof this.tabs[t].onunload&&this.tabs[t].onunload(),this.tabs[t].head.remove(),this.tabs[t].body.remove());this.list=[this.list[s]],this.tabs=[this.tabs[s]],this.active===s?(this.active=0,this.save()):(this.active=void 0,this.show(0)),t.listeners.trigger(this,"change")}},closeLeft(s){if(s>0&&s<this.tabs.length){let e=0;for(;e<s;)e===this.active&&"function"==typeof this.tabs[e].onhide&&this.tabs[e].onhide(),this.tabs[e].loaded&&"function"==typeof this.tabs[e].onunload&&this.tabs[e].onunload(),this.tabs[e].head.remove(),this.tabs[e].body.remove(),e++;this.list.splice(0,s),this.tabs.splice(0,s),this.active<s?(this.active=void 0,this.show(0)):(this.active-=s,this.save()),t.listeners.trigger(this,"change")}},closeRight(s){if(s>=0&&s<this.tabs.length-1){let e=s+1;const i=e;for(;e<this.tabs.length;)e===this.active&&"function"==typeof this.tabs[e].onhide&&this.tabs[e].onhide(),this.tabs[e].loaded&&"function"==typeof this.tabs[e].onunload&&this.tabs[e].onunload(),this.tabs[e].head.remove(),this.tabs[e].body.remove(),e++;e=this.tabs.length-i,this.list.splice(i,e),this.tabs.splice(i,e),this.active>s?(this.active=void 0,this.show(s)):this.save(),t.listeners.trigger(this,"change")}},reload(){"number"==typeof this.active&&"function"==typeof this.tabs[this.active].onload&&this.tabs[this.active].onload()},save(){localStorage.setItem("tab-"+this.name,JSON.stringify({active:this.active,list:this.list}))}};return e.innerHTML='<a class="reload" href="javascript:;">'+s.reload+'</a><a class="closeOther" href="javascript:;">'+s.closeOther+'</a><a class="closeLeft" href="javascript:;">'+s.closeLeft+'</a><a class="closeRight" href="javascript:;">'+s.closeRight+"</a>",t.appendCss(require.toUrl("common/tab/tab.less")),function(t,s,h,n,c){const l={__proto__:i,list:[],tabs:[]};l.name=t,l.cfg=s,l.tabCtn=h,l.tabContent=n,l.inv=c,c&&h.addClass("inv"),h.addEventListener("click",(function(t){let s;if(s=r(this.querySelector(":scope>span>span"),t.target)){const t=a(l,s.parentNode);l.active!==t&&l.show(t)}else(s=r(this.querySelector(":scope>span>a"),t.target))?l.close(a(l,s.parentNode)):(s=r(this.querySelector(":scope>span>div>a"),t.target))&&l[this.className](a(l,s.parentNode.parentNode))})),h.addEventListener("contextmenu",(function(t){let s;t.preventDefault(),(s=r(this.querySelectorAll(":scope>span"),t.target))&&e.parentNode!==s&&(s.appendChild(e),document.addEventListener("click",o))})),n.addEventListener("click",(function(t){let s;(s=r(this.querySelectorAll(".closepage"),t.target))&&l.close(a(l,h.querySelector("span.active")))}));let d=localStorage.getItem("tab-"+t);if("string"==typeof d&&(d=d.parseJsex(),d&&d.value&&"number"==typeof d.value.active&&Array.isArray(d.value.list))){for(let t=0;t<d.value.list.length;t++)l.add(d.value.list[t]);l.show(d.value.active)}return l};function a(t,s){for(let e=0;e<t.tabs.length;e++)if(s===t.tabs[e].head[0])return e}function h(t){const s=this.head.querySelector(":scope>span");s.title=s.textContent=t}function o(){document.removeEventListener("click",o),e.remove()}function n(t,s){if(s)for(const e in s)e in t||(t[e]=s[e])}function c(e,i){t.alert(s.error.replace("${res}",e)+i)}function l(){t.confirm(s.update,(function(t){t&&location.reload()}))}function r(t,s){for(let e=0;e<t.length;e++)if(t[e].contains(s))return t[e]}}));