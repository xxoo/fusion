"use strict";define(["common/kernel/kernel","./lang"],(function(t,e){let s=document.createElement("div");s.innerHTML='<a class="reload" href="javascript:;">'+e.reload+'</a><a class="closeOther" href="javascript:;">'+e.closeOther+'</a><a class="closeLeft" href="javascript:;">'+e.closeLeft+'</a><a class="closeRight" href="javascript:;">'+e.closeRight+"</a>";let i={open(e){let s,i,a;if(e.id in this.cfg){if(e.args){for(o(e.args,this.cfg[e.id].args),s=0;s<this.list.length;s++)if(t.isSameLocation(e,this.list[s])){i=!0;break}}else for(s=0;s<this.list.length;s++)if(this.list[s].id===e.id){i=!0;break}i?this.tabs[s].loaded&&(a=!0):s=this.add(e),this.show(s),a&&this.reload()}return s},add(e){let s,i,a="tab-"+this.name+"/"+e.id+"/",h=this;if(e.id in this.cfg){if(e.args||(e.args={}),o(e.args,this.cfg[e.id].args),i={head:document.createElement("span"),body:document.createElement("div"),args:e.args,parent:this,setTitle:n},i.head.innerHTML='<span title="'+this.cfg[e.id].title+'">'+this.cfg[e.id].title+'</span><a href="javascript:;"></a>',i.body.className=i.head.className=e.id,this.inv&&this.tabs.length?this.tabCtn.insertBefore(i.head,this.tabs[this.tabs.length-1].head):this.tabCtn.appendChild(i.head),this.tabContent.appendChild(i.body),s=this.list.length,this.list.push(e),this.tabs.push(i),"string"==typeof this.cfg[e.id].css&&(this.cfg[e.id].css=t.appendCss(require.toUrl(a+this.cfg[e.id].css))),2===this.cfg[e.id].status)r();else if(t.listeners.add(this.cfg[e.id],"complete",(function a(n){t.listeners.remove(h.cfg[e.id],"complete",a),s=h.tabs.indexOf(i),2===h.cfg[e.id].status?(r(),s>=0&&(void 0===h.active||h.active===s)&&h.show(s)):s>=0&&h.close(s)})),1!==this.cfg[e.id].status)if(this.cfg[e.id].status=1,"html"in this.cfg[e.id]){let s=require.toUrl(a+this.cfg[e.id].html);fetch(s).then((t=>{if(t.ok)return t.text().then((t=>{delete h.cfg[e.id].html,h.cfg[e.id].htmlContent=t,d()}));h.cfg[e.id].status=0,h.cfg[e.id].oncomplete({type:"complete"}),BUILD&&404===t.status?l():c(s,t.status)}),(t=>c(s,t.message))).then(t.hideLoading),t.showLoading()}else d();return this.save(),"function"==typeof this.onchange&&this.onchange({type:"change"}),s}function d(){let s;"js"in h.cfg[e.id]?(t.showLoading(),s=a+h.cfg[e.id].js,require([s],(function(s){delete h.cfg[e.id].js,h.cfg[e.id].proto=s,h.cfg[e.id].status=2,h.cfg[e.id].oncomplete({type:"complete"}),t.hideLoading()}),BUILD&&function(i){require.undef(s),h.cfg[e.id].status=0,h.cfg[e.id].oncomplete({type:"complete"}),i.requireType&&"scripterror"!==i.requireType&&"nodefine"!==i.requireType||i.xhr&&404!==i.xhr.status?c(s,i.message):l(),t.hideLoading()})):(h.cfg.status=2,h.cfg[e.id].oncomplete({type:"complete"}))}function r(){h.cfg[e.id].htmlContent&&(i.body.innerHTML=h.cfg[e.id].htmlContent),Object.assign(i,h.cfg[e.id].proto)}},show(t){let e;t>=0&&t<this.list.length&&("number"==typeof this.active&&this.active!==t&&("function"==typeof this.tabs[this.active].onhide&&this.tabs[this.active].onhide(),this.tabCtn.querySelector(":scope>span.active").classList.remve("active"),this.tabContent.querySelector(":scope>div.active").classList.remove("active")),this.tabs[t].body.classList.add("active"),this.tabs[t].head.classList.add("active"),2===this.cfg[this.list[t].id].status&&(this.tabs[t].loaded||(e=!0,"function"==typeof this.tabs[t].onload&&this.tabs[t].onload(),this.tabs[t].loaded=!0),this.active===t&&!e||"function"!=typeof this.tabs[t].onshow||this.tabs[t].onshow()),this.active=t,this.save())},close(t){t>=0&&t<this.tabs.length&&(this.active===t&&(this.list.length>t+1?this.show(t+1):this.list.length>1?this.show(t-1):("function"==typeof this.tabs[t].onhide&&this.tabs[t].onhide(),this.active=void 0)),this.tabs[t].loaded&&"function"==typeof this.tabs[t].onunload&&this.tabs[t].onunload(),this.tabs[t].head.remove(),this.tabs[t].body.remove(),this.tabs.splice(t,1),this.list.splice(t,1),this.active>t&&this.active--,this.save(),"function"==typeof this.onchange&&this.onchange({type:"change"}))},clear(){if(this.tabs.length){for(let t=0;t<this.list.length;t++)t===this.active&&"function"==typeof this.tabs[t].onhide&&this.tabs[t].onhide(),this.tabs[t].loaded&&"function"==typeof this.tabs[t].onunload&&this.tabs[t].onunload(),this.tabs[t].head.remove(),this.tabs[t].body.remove();this.list=[],this.tabs=[],this.active=void 0,this.save(),"function"==typeof this.onchange&&this.onchange({type:"change"})}},closeOther(t){if(t>0&&t<this.tabs.length-1){for(let e=0;e<this.list.length;e++)e!==t&&(e===this.active&&"function"==typeof this.tabs[e].onhide&&this.tabs[e].onhide(),this.tabs[e].loaded&&"function"==typeof this.tabs[e].onunload&&this.tabs[e].onunload(),this.tabs[e].head.remove(),this.tabs[e].body.remove());this.list=[this.list[t]],this.tabs=[this.tabs[t]],this.active===t?(this.active=0,this.save()):(this.active=void 0,this.show(0)),"function"==typeof this.onchange&&this.onchange({type:"change"})}},closeLeft(t){if(t>0&&t<this.tabs.length){let e=0;for(;e<t;)e===this.active&&"function"==typeof this.tabs[e].onhide&&this.tabs[e].onhide(),this.tabs[e].loaded&&"function"==typeof this.tabs[e].onunload&&this.tabs[e].onunload(),this.tabs[e].head.remove(),this.tabs[e].body.remove(),e++;this.list.splice(0,t),this.tabs.splice(0,t),this.active<t?(this.active=void 0,this.show(0)):(this.active-=t,this.save()),"function"==typeof this.onchange&&this.onchange({type:"change"})}},closeRight(t){if(t>=0&&t<this.tabs.length-1){let e=t+1,s=e;for(;e<this.tabs.length;)e===this.active&&"function"==typeof this.tabs[e].onhide&&this.tabs[e].onhide(),this.tabs[e].loaded&&"function"==typeof this.tabs[e].onunload&&this.tabs[e].onunload(),this.tabs[e].head.remove(),this.tabs[e].body.remove(),e++;e=this.tabs.length-s,this.list.splice(s,e),this.tabs.splice(s,e),this.active>t?(this.active=void 0,this.show(t)):this.save(),"function"==typeof this.onchange&&this.onchange({type:"change"})}},reload(){"number"==typeof this.active&&"function"==typeof this.tabs[this.active].onload&&this.tabs[this.active].onload()},save(){localStorage.setItem("tab-"+this.name,JSON.stringify({active:this.active,list:this.list}))}};return t.appendCss(require.toUrl("common/tab/tab.less")),function(t,e,n,o,c){let l=Object.create(i);l.list=[],l.tabs=[],l.name=t,l.cfg=e,l.tabCtn=n,l.tabContent=o,l.inv=c,c&&n.addClass("inv"),n.addEventListener("click",(function(t){let e;if(e=d(this.querySelector(":scope>span>span"),t.target)){let t=a(l,e.parentNode);l.active!==t&&l.show(t)}else(e=d(this.querySelector(":scope>span>a"),t.target))?l.close(a(l,e.parentNode)):(e=d(this.querySelector(":scope>span>div>a"),t.target))&&l[this.className](a(l,e.parentNode.parentNode))})),n.addEventListener("contextmenu",(function(t){let e;t.preventDefault(),(e=d(this.querySelectorAll(":scope>span"),t.target))&&s.parentNode!==e&&(e.appendChild(s),document.addEventListener("click",h))})),o.addEventListener("click",(function(t){let e;(e=d(this.querySelectorAll(".closepage"),t.target))&&l.close(a(l,n.querySelector("span.active")))}));let r=localStorage.getItem("tab-"+t);if("string"==typeof r&&(r=r.parseJsex(),r&&r.value&&"number"==typeof r.value.active&&Array.isArray(r.value.list))){for(let t=0;t<r.value.list.length;t++)l.add(r.value.list[t]);l.show(r.value.active)}return l};function a(t,e){for(let s=0;s<t.tabs.length;s++)if(e===t.tabs[s].head[0])return s}function n(t){let e=this.head.querySelector(":scope>span");e.title=e.textContent=t}function h(){document.removeEventListener("click",h),s.remove()}function o(t,e){if(e)for(let s in e)s in t||(t[s]=e[s])}function c(s,i){t.alert(e.error.replace("${res}",s)+i)}function l(){t.confirm(e.update,(function(t){t&&location.reload()}))}function d(t,e){for(let s=0;s<t.length;s++)if(t[s].contains(e))return t[s]}}));